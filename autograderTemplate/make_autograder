#!/usr/bin/env bash

# Run this script to generate the file AUTOGRADER_ZIP, in a non-public directory, for upload to Gradescope.
AUTOGRADER_ZIP=autograder.zip

# Usage:
# make_autograder -r user/gradertestsrepo.git -k /path/to/private/key 
# Notes:
#   Run this file from the directory where you would like the autograder .zip file to be generated.
#   This directory must be private (or non-version-controlled). A recommendation is to add the template to your path
# Arguments:
# -r user/gradertestsrepo.git == your private repository containing your mAutograder tests
# -k /path/to/private/key == local path to the private deploy key that corresponds with your private tests repo (the -r argument)

# we now force the user to supply the path to the private key so that this repository can remain public
if [[ $# -eq 0 ]] ; then
    echo "WARNING - No argument supplied, so the private key to your solutions repository will NOT be included in autograder.zip."
elif [[ $# -eq 1 ]] ; then
    KEYFILENAME=$1
    KEYFILELOCALNAME="${KEYFILENAME##*/}"
    echo "Including the file $KEYFILENAME as $KEYFILELOCALNAME"
fi

# Copy all 

if [ -f "$AUTOGRADER_ZIP" ]; then
    rm "$AUTOGRADER_ZIP"
fi

# Was, with manual path to private deploy key:
#zip -r "$AUTOGRADER_ZIP" id_rsa_deploy_key run_autograder setup*.sh ssh_config_template # cvx_compile_all.m *.patch

# with argument path to deploy key:
zip -r "$AUTOGRADER_ZIP" run_autograder setup*.sh ssh_config_template -j $1 # cvx_compile_all.m *.patch

source setup_variables.sh
source setup_variables.sh
echo $0: Remember to change the repository sub-dir in setup_variables if necessary
echo $0: Current value for MAUTOGRADE_TESTS_DIR is $MAUTOGRADE_TESTS_DIR
